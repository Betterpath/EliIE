#!/bin/bash

set -x
set -e

TAG=betterpath/eliie
NAME=eliie

function usage () {
    echo "Usage: ./deployment/bin/compose [up | eliie [bash | parse | skr | wsd]]"
}

case "$1" in
    "up")
        source .env
        docker rm -f $NAME | true
        docker build . -t $TAG --build-arg S3_KEY=$S3_KEY --build-arg S3_SECRET=$S3_SECRET
        docker run --name $NAME -v $(pwd)/Tempfile:/code/Tempfile -itd $TAG 
        ;;
    "eliie")
        shift;
        case "$1" in
            "skr")
                docker exec -it $NAME /code/skr.sh
                ;;
            "wsd")
                docker exec -it $NAME /code/wsd.sh
                ;;
            "parse")
                docker exec -it $NAME bash -c "cd /code && ./wrapper_for_parsing.sh"
                ;;
            "bash")
                docker exec -it $NAME bash
                ;;
            *)
                usage
                ;;
        esac
        ;;
    *)
        usage
        ;;
esac
